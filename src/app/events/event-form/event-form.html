
<form>
  <div class="budget-list-card">
    <h3 class="list-card-title">Datos del evento:</h3>
    <div class="form-wrapper">
      <div>
        <label for="title">T√≠tulo: </label>
        @if (isEditMode()) {
          <input type="text" id="title-readonly" [value]="eventFormModel().title" readonly class="readonly-field">
        } @else {
          <input type="text" id="title" [formField]="createEventForm.title" placeholder="T√≠tulo del evento" aria-label="Titulo">
        }
      </div>
      <div>
        <label for="description">Descripci√≥n: </label>
        <input type="text" id="description" [formField]="createEventForm.description" placeholder="Descripci√≥n" aria-label="Descripcion">
      </div>
      <div>
        <label for="hobby">Escoger categor√≠a del hobby: </label>
        @if (isEditMode()) {
          <select id="hobby-readonly" disabled class="readonly-field">
            <option [value]="eventFormModel().hobby" selected>
              {{ eventFormModel().hobby }}
            </option>
          </select>
        } @else {
          <select id="hobby" [formField]="createEventForm.hobby">
            <option value="" disabled>Selecciona un hobby</option>
            @for (hobby of hobbies; track hobby) {
              <option [value]="hobby">{{ hobby }}</option>
            }
          </select>
        }
      </div>
      <div>
        <label for="date">Fecha: </label>
        <input type="date" id="date" [formField]="createEventForm.date" placeholder="Fecha" aria-label="Fecha">
      </div>

      <!-- SECCI√ìN DE UBICACI√ìN -->
      <div class="location-section">
        <label>Ubicaci√≥n del evento: </label>

        @if (hasLocation) {
          <!-- Preview de ubicaci√≥n seleccionada -->
          <div class="location-preview">
            <div class="preview-header">
              <span class="location-icon">üìç</span>
              <div class="location-details">
                <span class="location-label">Ubicaci√≥n seleccionada</span>
                <span class="location-coords">{{ locationText }}</span>
              </div>
            </div>

            <!-- Mini mapa de preview -->
            <div class="mini-map">
              <iframe
                width="600"
                height="450"
                style="border:0;"
                [src]="getSafeUrl()"
                allowfullscreen>
              </iframe>
            </div>

            <div class="location-actions">
              <button
                type="button"
                class="btn-change-location"
                (click)="openLocationPicker()">
                üìù Cambiar ubicaci√≥n
              </button>
              <button
                type="button"
                class="btn-remove-location"
                (click)="removeLocation()">
                üóëÔ∏è Eliminar
              </button>
            </div>
          </div>
        } @else {
          <!-- Bot√≥n para abrir el selector -->
          <div class="location-placeholder">
            <button
              type="button"
              class="btn-select-location"
              (click)="openLocationPicker()">
              üìç Seleccionar ubicaci√≥n en el mapa
            </button>
            <p class="helper-text">
              Haz clic para abrir el mapa y seleccionar d√≥nde se realizar√° el evento
            </p>
          </div>
        }

        @if (!hasLocation && buttonSubmitClicked()) {
          <div class="location-error">
            <small>La ubicaci√≥n es obligatoria</small>
          </div>
        }
      </div>

      @if (isEditMode()) {
        <button type="button" class="submit-button" (click)="onSubmitEventForm()">Guardar modificaciones</button>
      } @else {
        <button type="button" class="submit-button" (click)="onSubmitEventForm()">Crear evento</button>
      }
    </div>

    @if (!this.createEventForm().valid() && this.buttonSubmitClicked()) {
      <div class="form-error-message">
        <small>S'han d'omplir tots els camps de dades</small>
      </div>
    }
  </div>
</form>

<!-- Modal de selecci√≥n de ubicaci√≥n -->
<app-location-picker-modal
  [isOpen]="isLocationModalOpen"
  [initialCoords]="selectedLocation() ?? undefined"
  (locationConfirmed)="onLocationConfirmed($event)"
  (modalClosed)="onModalClosed()">
</app-location-picker-modal>
